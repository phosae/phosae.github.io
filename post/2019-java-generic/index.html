<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Java 类型擦除与泛型信息恢复 - ZengXu&#39;s BLOG</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Zeng Xu" /><meta name="description" content="类型擦除（Type Erasure）其实潜藏着 2 层概念：对于 JVM 而言，泛型参数被擦除了；对于 Java 语言来说，泛型信息得到了很大程度保留" /><meta name="keywords" content="java" />






<meta name="generator" content="Hugo 0.87.0 with theme even" />


<link rel="canonical" href="https://www.zeng.dev/post/2019-java-generic/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.002f7338df464ade44c04c92566f06e169f8fc2f54deda7f6dff1fe7badee057.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Java 类型擦除与泛型信息恢复" />
<meta property="og:description" content="类型擦除（Type Erasure）其实潜藏着 2 层概念：对于 JVM 而言，泛型参数被擦除了；对于 Java 语言来说，泛型信息得到了很大程度保留" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.zeng.dev/post/2019-java-generic/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2019-06-23T08:15:19+08:00" />
<meta property="article:modified_time" content="2019-06-28T08:15:19+08:00" />

<meta itemprop="name" content="Java 类型擦除与泛型信息恢复">
<meta itemprop="description" content="类型擦除（Type Erasure）其实潜藏着 2 层概念：对于 JVM 而言，泛型参数被擦除了；对于 Java 语言来说，泛型信息得到了很大程度保留"><meta itemprop="datePublished" content="2019-06-23T08:15:19+08:00" />
<meta itemprop="dateModified" content="2019-06-28T08:15:19+08:00" />
<meta itemprop="wordCount" content="3059">
<meta itemprop="keywords" content="java," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Java 类型擦除与泛型信息恢复"/>
<meta name="twitter:description" content="类型擦除（Type Erasure）其实潜藏着 2 层概念：对于 JVM 而言，泛型参数被擦除了；对于 Java 语言来说，泛型信息得到了很大程度保留"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Zeng Xu&#39;s BLOG</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">主页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="https://www.notion.so/zengxu/Zeng-Xu-s-Little-World-a6b002fb4d134333abe74a4e0491cea7">
        <li class="mobile-menu-item">杂文</li>
      </a><a href="/about">
        <li class="mobile-menu-item">我</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Zeng Xu&#39;s BLOG</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">主页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://www.notion.so/zengxu/Zeng-Xu-s-Little-World-a6b002fb4d134333abe74a4e0491cea7">杂文</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about">我</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Java 类型擦除与泛型信息恢复</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-06-23 08:15 </span>
        
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#类型擦除type-erasure">类型擦除（Type Erasure)</a>
      <ul>
        <li><a href="#类型转换检查指令插入">类型转换检查指令插入</a></li>
      </ul>
    </li>
    <li><a href="#泛型信息恢复">泛型信息恢复</a>
      <ul>
        <li><a href="#类泛型信息恢复">类泛型信息恢复</a></li>
        <li><a href="#字段泛型信息恢复">字段泛型信息恢复</a></li>
        <li><a href="#方法泛型信息恢复">方法泛型信息恢复</a></li>
        <li><a href="#泛型信息动态生成">泛型信息动态生成</a></li>
      </ul>
    </li>
    <li><a href="#总结">总结</a></li>
    <li><a href="#延伸阅读">延伸阅读</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>讨论起 Java 泛型，书籍博客经常会提到类型擦除（Type Erasure），其实潜藏着 2 层意思：</p>
<ul>
<li>类型擦除其实是一个运行时概念，指的是对于 JVM 而言，泛型参数被擦除了。</li>
<li>对于 Java 语言来说，泛型信息其实得到了很大程度保留，否则便无法解决数据对象的反序列化问题</li>
</ul>
<h2 id="类型擦除type-erasure">类型擦除（Type Erasure)</h2>
<p>类型擦除实现意味着运行期间，JVM 并不知道类型信息，直观感受是：</p>
<ul>
<li>无法使用泛型创建对象</li>
<li>无法使用泛型创建数组</li>
<li>无法针对泛型执行实例判断</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleGeneric</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="n">T</span> <span class="n">t</span><span class="o">;</span>

    <span class="n">SimpleGeneric</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kt">void</span> <span class="nf">erased</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 无法使用泛型创建对象
</span><span class="c1"></span>        <span class="c1">// T nt = new T();
</span><span class="c1"></span>
        <span class="c1">// 无法使用泛型创建数组
</span><span class="c1"></span>        <span class="c1">// T[] arr = new T[];
</span><span class="c1"></span>
        <span class="c1">// 无法针对泛型执行实例判断
</span><span class="c1"></span>        <span class="c1">// if(t instanceof T){
</span><span class="c1"></span>        <span class="c1">//     ...
</span><span class="c1"></span>        <span class="c1">// }
</span><span class="c1"></span>    <span class="o">}</span>

    <span class="n">T</span> <span class="nf">getTarget</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">t</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SimpleGeneric</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">strSg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleGeneric</span><span class="o">&lt;&gt;(</span><span class="s">&#34;hello&#34;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="n">strSg</span><span class="o">.</span><span class="na">getTarget</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>使用 <code>javap -v SimpleGeneric.class</code> 查看编译后的字节码描述符可以发现：</p>
<ul>
<li>字段 t 对应 <code>Ljava/lang/Object;</code></li>
<li>单参构造函数对应 <code>(Ljava/lang/Object;)V</code></li>
<li>方法 getTarget 对应 <code>()Ljava/lang/Object;</code></li>
</ul>
<p>如果我们将类声明改为 <code>SimpleGeneric&lt;T extends CharSequence&gt;</code>，对应的描述符则变为如下</p>
<ul>
<li>字段 t 对应 <code>Ljava/lang/CharSequence;</code></li>
<li>单参构造函数对应 <code>(Ljava/lang/CharSequence;)V</code></li>
<li>方法 getTarget 对应 <code> ()Ljava/lang/CharSequence;</code></li>
</ul>
<p>也就是说，如果泛型参数没有 extends 限定，类型被擦除为 Object，如果有 extends 限定，类型被擦除为限定类型。如果有多个限定类型，如 <code>SimpleGeneric&lt;T extends CharSequence &amp; Comparable&lt;? extends CharSequence&gt;&gt;</code>，则类型被擦除为最左边的限定（即 CharSequence）。</p>
<h3 id="类型转换检查指令插入">类型转换检查指令插入</h3>
<p>进一步观察 main 函数 <code>String str = strSg.getTarget();</code> 字节码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="hl"><span class="lnt">3
</span></span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">aload_1</span>           <span class="c1">// 加载对象引用 strSg 到操作栈
</span><span class="c1"></span><span class="n">invokevirtual</span> <span class="err">#</span><span class="n">6</span>  <span class="c1">// 方法调用 getTarget:()Ljava/lang/Object;
</span><span class="hl"><span class="c1"></span><span class="n">checkcast</span>     <span class="err">#</span><span class="n">7</span>  <span class="c1">// class java/lang/String，检查方法返回是否为 String 类型
</span></span><span class="c1"></span><span class="n">astore_2</span>          <span class="c1">// 存储返回对象引用到局部变量表（相当于 String str = {目标值}） 
</span></code></pre></td></tr></table>
</div>
</div><p>在涉及泛型赋值处，Java 编译器会插入 <code>checkcast</code> 指令，保证类型安全。如果指令失败（返回类型与目标类型不匹配），JVM 会抛出 ClassCastException。</p>
<p>这点是为保证泛型体系与非泛型体系兼容而设置，下面代码展示类型检查必要性</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">List&lt;String&gt; strs = new ArrayList&lt;&gt;();
List rawList = strs;
rawList.add(1);
String str = strs.get(0); // 这里将抛出 ClassCastException
...
</code></pre></td></tr></table>
</div>
</div><p>Java 为保证泛型体系与 1.5 之前体系兼容，允许泛型 List<String> 到裸类型 List 赋值。代码接着往 List 对象加入整型 1，由于类型擦除，JVM 并不阻止这种行为。最后，代码尝试取值，由于 <code>checkcast</code> 指令作用，代码流程被终止。</p>
<p>这里如果不做检查而将 Integer 对象赋给 String 引用，将发生不可预期后果，所以 Java 语言选择抛出异常终止代码运行。</p>
<p>正如 <a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-4.html">Java 语言规范第 8 版</a> 指出，编译器实施的类型擦除、类型转换检查指令插入和桥接方法生成一起构成了 Java 泛型实现</p>
<blockquote>
<p>To implement generics, the Java compiler applies type erasure to:</p>
<p>1.Replace all type parameters in generic types with their bounds or Object if the type
parameters are unbounded. The produced bytecode, therefore, contains only ordinary classes,
interfaces, and methods.</p>
<p>2.Insert type casts if necessary to preserve type safety.</p>
<p>3.Generate bridge methods to preserve polymorphism in extended generic types.</p>
</blockquote>
<p>桥接方法是指针对涉及泛型类的实现或者继承情况，编译器会在子类中自动插入桥接类型方法，保证子类正常覆写父类方法，维续 Java 语言的多态特性，详细介绍见 <a href="https://docs.oracle.com/javase/tutorial/java/generics/bridgeMethods.html">Oracle Java 泛型介绍#桥接方法</a> 和 <a href="https://stackoverflow.com/questions/5007357/java-generics-bridge-method">stackoverflow 讨论</a>。</p>
<h2 id="泛型信息恢复">泛型信息恢复</h2>
<p>上文提到，类型擦除更多只是针对 JVM 而言。事实上，Java 编译器仍在 class 文件以 Signature 属性的方式保留了泛型信息。对于 JVM 而言，Signature 并不是必须属性，其作用类似标签。运行期间，Java 类库可以利用这些标签恢复泛型信息（Class 类和反射包）。</p>
<p>下面将以 Generic 类为例展示信息恢复：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Generic</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">;</span>

    <span class="kd">public</span> <span class="o">&lt;</span><span class="n">EX</span> <span class="kd">extends</span> <span class="n">NullPointerException</span><span class="o">&gt;</span> <span class="n">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">CharSequence</span><span class="o">&gt;</span> <span class="nf">doSomething</span><span class="o">(</span><span class="n">T</span> <span class="n">task</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">EX</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>使用 javap 查看 Generic.class 字节码可以找到这些 Signature</p>
<ul>
<li>class <strong>Generic</strong> signature: <code>&lt;T::Ljava/lang/Comparable&lt;TT;&gt;;&gt;Ljava/lang/Object;</code></li>
<li>method <strong>doSomething</strong> signature: <code>&lt;EX:Ljava/lang/NullPointerException;&gt;(TT;)Ljava/util/List&lt;+Ljava/lang/CharSequence;&gt;;^TEX;</code></li>
<li>field <strong>list</strong> signature: <code>Ljava/util/List&lt;TT;&gt;;</code></li>
</ul>
<p>Java 泛型系统由 5  种类型构成</p>
<ul>
<li>TypeVariable，对应 <code>&lt;T extends Comparable&lt;T&gt;&gt;</code> 中的 T 标识，它可以由 extends 设置 upper 限定，由 super 设置 lower 限定，这里 upper 限定为 Comparable。Java 可以在类、构造方法、普通方法三处声明 TypeVariable</li>
<li>ParameterizedType，对应 <code>List&lt;T&gt;</code>、<code>List&lt;String&gt;</code> 等格式</li>
<li>WildCardType，对应 <code>? extends CharSequence</code> 中的 <code>?</code>，它可以有由 extends 设置 upper 限定，由 super 设置 lower 限定，这里 upper 限定为 CharSequence</li>
<li>GenericArrayType，对应 <code>T[]</code></li>
<li>Class，又称之为裸类型（RawType)，对应不带尖括号 <code>&lt;&gt;</code> 类，诸如 <code>List</code>, <code>Generic</code></li>
</ul>
<h3 id="类泛型信息恢复">类泛型信息恢复</h3>
<p>Class 类提供的 getTypeParameters, getGenericSuperclass 和 getGenericInterfaces 可分别用于获取类声明泛型信息、类似声明中父类泛型信息和类声明中接口泛型信息。</p>
<p>下面代码展示了如何获取 Generic 类声明中的 TypeVariable <code>T extends Comparable&lt;T&gt;</code> 信息</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">TypeVariable</span> <span class="n">clzParam</span> <span class="o">=</span> <span class="o">(</span><span class="n">TypeVariable</span><span class="o">)</span>  <span class="n">Generic</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getTypeParameters</span><span class="o">()[</span><span class="n">0</span><span class="o">];</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;class info : &#34;</span> <span class="o">+</span> <span class="n">clzParam</span> <span class="o">+</span> <span class="s">&#34;, class typeVariable bounds : &#34;</span> <span class="o">+</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">clzParam</span><span class="o">.</span><span class="na">getBounds</span><span class="o">()));</span>

<span class="c1">//~
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">typeVariable</span> <span class="n">info</span> <span class="o">:</span> <span class="n">T</span><span class="o">,</span> <span class="kd">class</span> <span class="nc">typeVariable</span> <span class="n">bounds</span> <span class="o">:</span> <span class="o">[</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Comparable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;]</span>
</code></pre></td></tr></table>
</div>
</div><p>声明 SubGeneric 类继承类 <code>Generic&lt;String&gt;</code> 并实现接口 <code>Consumer&lt;String&gt;</code>，其字节码文件保留的 class Signature 为 <code>Ltype/Generic&lt;Ljava/lang/String;&gt;;Ljava/util/function/Consumer&lt;Ljava/lang/String;&gt;;</code>。对应泛型信息可按如下方式获取</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">SubGeneric</span> <span class="kd">extends</span> <span class="n">Generic</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Consumer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;{</span>
  <span class="o">...</span>
<span class="o">}</span>
<span class="o">---</span>
<span class="n">ParameterizedType</span> <span class="n">pClzParamType</span> <span class="o">=</span> <span class="o">(</span><span class="n">ParameterizedType</span><span class="o">)</span> <span class="n">SubGeneric</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getGenericSuperclass</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;parent class param type info : &#34;</span> <span class="o">+</span> <span class="n">pClzParamType</span><span class="o">);</span>

<span class="n">ParameterizedType</span> <span class="n">pInterfaceParamType</span> <span class="o">=(</span><span class="n">ParameterizedType</span><span class="o">)</span> <span class="n">SubGeneric</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getGenericInterfaces</span><span class="o">()[</span><span class="n">0</span><span class="o">];</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;parent interface param type info : &#34;</span> <span class="o">+</span> <span class="n">pInterfaceParamType</span><span class="o">);</span>

<span class="c1">//~
</span><span class="c1"></span><span class="n">parent</span> <span class="kd">class</span> <span class="nc">param</span> <span class="n">type</span> <span class="n">info</span> <span class="o">:</span> <span class="n">type</span><span class="o">.</span><span class="na">Generic</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">&gt;</span>
<span class="n">parent</span> <span class="kd">interface</span> <span class="nc">param</span> <span class="n">type</span> <span class="n">info</span> <span class="o">:</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">function</span><span class="o">.</span><span class="na">Consumer</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>有一种常见场景是在方法中创建 TypeVariable 为某种具体类型的对象，如 <code>Generic&lt;String&gt; gs = new Generic&lt;&gt;()</code>，同时想要获取该对象的泛型信息。由于类型擦除，局部变量的泛型信息确实无从获取。针对这种场景，可以利用匿名类保留变量泛型信息（Java 编译器会为匿名类生成  class 文件）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Generic</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">gs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Generic</span><span class="o">&lt;&gt;(){};</span>
<span class="n">Class</span> <span class="n">anonymousClz</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
<span class="n">ParameterizedType</span> <span class="n">varClz</span> <span class="o">=</span> <span class="o">(</span><span class="n">ParameterizedType</span><span class="o">)</span> <span class="n">anonymousClz</span><span class="o">.</span><span class="na">getGenericSuperclass</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;varClz class info : &#34;</span> <span class="o">+</span> <span class="n">varClz</span><span class="o">);</span>

<span class="c1">//~
</span><span class="c1"></span><span class="n">varClz</span> <span class="kd">class</span> <span class="nc">info</span> <span class="o">:</span> <span class="n">type</span><span class="o">.</span><span class="na">Generic</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="字段泛型信息恢复">字段泛型信息恢复</h3>
<p>Field 类提供的 getGenericType 方法可以用于获取字段泛型信息</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Field</span> <span class="n">listField</span> <span class="o">=</span> <span class="n">Generic</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;list&#34;</span><span class="o">);</span>
<span class="n">ParameterizedType</span> <span class="n">fieldParamType</span> <span class="o">=</span> <span class="o">(</span><span class="n">ParameterizedType</span><span class="o">)</span> <span class="n">listField</span><span class="o">.</span><span class="na">getGenericType</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;field type info : &#34;</span> <span class="o">+</span> <span class="n">fieldParamType</span><span class="o">);</span>
<span class="n">TypeVariable</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&gt;</span> <span class="n">fieldParamArg</span> <span class="o">=</span> <span class="o">(</span><span class="n">TypeVariable</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&gt;)</span> <span class="n">fieldParamType</span><span class="o">.</span><span class="na">getActualTypeArguments</span><span class="o">()[</span><span class="n">0</span><span class="o">];</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;field&amp;class typeVariable bounds : &#34;</span> <span class="o">+</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">fieldParamArg</span><span class="o">.</span><span class="na">getBounds</span><span class="o">()));</span>

<span class="c1">//~
</span><span class="c1"></span><span class="n">field</span> <span class="n">type</span> <span class="n">info</span> <span class="o">:</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
<span class="n">field</span><span class="o">&amp;</span><span class="kd">class</span> <span class="nc">typeVariable</span> <span class="n">bounds</span> <span class="o">:</span> <span class="o">[</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Comparable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;]</span>
</code></pre></td></tr></table>
</div>
</div><p>遇到类似上一节场景，即在方法中创建 TypeVariable 为某种具体类型的对象，同时要获取对象字段的具体类型，TypeVariable 类 getGenericDeclaration 方法可用于获取其声明处。如果应用通过匿名类的方式保留了具体类型信息，只需将匿名类中的具体类型与字段 TypeVariable 对应上即可。</p>
<h3 id="方法泛型信息恢复">方法泛型信息恢复</h3>
<p>Method 类提供的 getGenericParameterTypes、getGenericExceptionTypes 和  getGenericReturnType 可分别用于获取参数、异常和返回的泛型信息</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Method</span> <span class="n">m</span> <span class="o">=</span> <span class="n">Generic</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="s">&#34;doSomething&#34;</span><span class="o">,</span> <span class="n">Comparable</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="n">TypeVariable</span><span class="o">&lt;</span><span class="n">Method</span><span class="o">&gt;</span> <span class="n">paramType</span> <span class="o">=</span> <span class="o">(</span><span class="n">TypeVariable</span><span class="o">&lt;</span><span class="n">Method</span><span class="o">&gt;)</span> <span class="n">m</span><span class="o">.</span><span class="na">getGenericParameterTypes</span><span class="o">()[</span><span class="n">0</span><span class="o">];</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;method argument info : class typeVariable &#34;</span> <span class="o">+</span> <span class="n">paramType</span> <span class="o">+</span> <span class="s">&#34;, bounds : &#34;</span>
        <span class="o">+</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">paramType</span><span class="o">.</span><span class="na">getBounds</span><span class="o">()));</span>

<span class="n">ParameterizedType</span> <span class="n">retParamType</span> <span class="o">=</span> <span class="o">(</span><span class="n">ParameterizedType</span><span class="o">)</span> <span class="n">m</span><span class="o">.</span><span class="na">getGenericReturnType</span><span class="o">();</span>
<span class="n">WildcardType</span> <span class="n">retWildcardTypeArg</span> <span class="o">=</span> <span class="o">(</span><span class="n">WildcardType</span><span class="o">)</span> <span class="n">retParamType</span><span class="o">.</span><span class="na">getActualTypeArguments</span><span class="o">()[</span><span class="n">0</span><span class="o">];</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;method return type info : &#34;</span> <span class="o">+</span> <span class="n">retParamType</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;method return type args : &#34;</span> <span class="o">+</span> <span class="n">retWildcardTypeArg</span><span class="o">);</span>

<span class="n">TypeVariable</span><span class="o">&lt;</span><span class="n">Method</span><span class="o">&gt;</span> <span class="n">exType</span> <span class="o">=</span> <span class="o">(</span><span class="n">TypeVariable</span><span class="o">&lt;</span><span class="n">Method</span><span class="o">&gt;)</span> <span class="n">m</span><span class="o">.</span><span class="na">getGenericExceptionTypes</span><span class="o">()[</span><span class="n">0</span><span class="o">];</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;method exception info : method typeVariable &#34;</span> <span class="o">+</span> <span class="n">exType</span> <span class="o">+</span> <span class="s">&#34;, bounds : &#34;</span>
        <span class="o">+</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">exType</span><span class="o">.</span><span class="na">getBounds</span><span class="o">()));</span>

<span class="c1">//~
</span><span class="c1"></span><span class="n">method</span> <span class="n">argument</span> <span class="n">info</span> <span class="o">:</span> <span class="kd">class</span> <span class="nc">typeVariable</span> <span class="n">T</span><span class="o">,</span> <span class="n">bounds</span> <span class="o">:</span> <span class="o">[</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Comparable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;]</span>
<span class="n">method</span> <span class="k">return</span> <span class="n">type</span> <span class="n">info</span> <span class="o">:</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">CharSequence</span><span class="o">&gt;</span>
<span class="n">method</span> <span class="k">return</span> <span class="n">type</span> <span class="n">args</span> <span class="o">:</span> <span class="o">?</span> <span class="kd">extends</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">CharSequence</span>
<span class="n">method</span> <span class="n">exception</span> <span class="n">info</span> <span class="o">:</span> <span class="n">method</span> <span class="n">typeVariable</span> <span class="n">EX</span><span class="o">,</span> <span class="n">bounds</span> <span class="o">:</span> <span class="o">[</span><span class="kd">class</span> <span class="nc">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">NullPointerException</span><span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="泛型信息动态生成">泛型信息动态生成</h3>
<p>某些场景会涉及泛型信息的动态生成，如根据 HTTP URI 解析响应到某种泛型的特定类型，这时应用需要自行构造 ParameterizedType 实现对象。JDK 自身实现在 <code>sun.reflect.generics.reflectiveObjects</code> 包，JDK 9 后应用无法直接访问。guava 库提供了包含 ParameterizedType, WildcardType, GenericArrayType 在内的实现类，可直接利用 <a href="https://github.com/google/guava">Guava</a> 库包装类 TypeToken 动态获取实现对象</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"> <span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageBody</span><span class="o">&lt;</span><span class="n">D</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="n">Integer</span> <span class="n">code</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">errorMessage</span><span class="o">;</span>
    <span class="n">D</span> <span class="n">data</span><span class="o">;</span>
<span class="o">}</span>
<span class="o">---</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">dynamicGeneric</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span> <span class="n">clz</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">TypeToken</span><span class="o">&lt;</span><span class="n">MessageBody</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;&gt;</span> <span class="n">dynamicTypeToken</span> <span class="o">=</span>
            <span class="k">new</span> <span class="n">TypeToken</span><span class="o">&lt;</span><span class="n">MessageBody</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;&gt;()</span> <span class="o">{}.</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">TypeParameter</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;()</span> <span class="o">{},</span> <span class="n">TypeToken</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">clz</span><span class="o">));</span>

    <span class="n">Type</span> <span class="n">dynamicType</span> <span class="o">=</span> <span class="n">dynamicTypeToken</span><span class="o">.</span><span class="na">getType</span><span class="o">();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dynamicType</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dynamicType</span> <span class="k">instanceof</span> <span class="n">ParameterizedType</span><span class="o">);</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
  <span class="n">dynamicGeneric</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="o">}</span>
<span class="c1">//~
</span><span class="c1"></span><span class="n">type</span><span class="o">.</span><span class="na">MessageBody</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">&gt;</span>
<span class="kc">true</span>
</code></pre></td></tr></table>
</div>
</div><p>下面的例子展示了 Map&lt;K,V&gt; 泛型信息动态生成</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">static</span> <span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="n">TypeToken</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">mapOf</span><span class="o">(</span>
        <span class="n">TypeToken</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;</span> <span class="n">keyType</span><span class="o">,</span> <span class="n">TypeToken</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">valueType</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TypeToken</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;&gt;()</span> <span class="o">{}</span>
            <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">TypeParameter</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;()</span> <span class="o">{},</span> <span class="n">keyType</span><span class="o">)</span>
            <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">TypeParameter</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;()</span> <span class="o">{},</span> <span class="n">valueType</span><span class="o">);</span>
<span class="o">}</span>
<span class="o">---</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>    
    <span class="n">ParameterizedType</span> <span class="n">paramMap</span> <span class="o">=</span>
                <span class="o">(</span><span class="n">ParameterizedType</span><span class="o">)</span> <span class="n">mapOf</span><span class="o">(</span><span class="n">TypeToken</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="n">TypeToken</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)).</span><span class="na">getType</span><span class="o">();</span>
    
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">paramMap</span><span class="o">);</span>
<span class="o">}</span>
<span class="c1">//~
</span><span class="c1"></span><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Map</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">,</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="总结">总结</h2>
<p>Java 为保持对旧版本支持，1.5 以类型擦除这种比较讨巧的方式实现了泛型体系。回顾上文，我们发现它虽然带来了一些不便，但是通过一些编程技巧可以恢复出需要的泛型信息。</p>
<p>这种实现方式的弊端更多是性能损耗，比如字节码中频繁的 <code>checkcast</code> 指令和集合框架中处处可见的强制类型转换；再比如不支持 int, char, bool 等 primitive 类型，使得泛型的类库都只能使用包装类。</p>
<p>目前 OpenJDK <a href="https://wiki.openjdk.java.net/display/valhalla">valhalla 项目</a> 正尝试采用包括引入值类型在内的多种尝试来解决 Java 泛型历史遗留问题，感兴趣可以关注。</p>
<h2 id="延伸阅读">延伸阅读</h2>
<ul>
<li><a href="https://www.baeldung.com/java-generics">Baeldung: The Basics of Java Generics</a></li>
<li><a href="https://docs.oracle.com/javase/tutorial/java/generics/ww">Oracle Java 泛型介绍</a></li>
<li><a href="https://en.wikipedia.org/wiki/Generics_in_Java#Type_erasure">Wikipedia: Generics in Java</a></li>
<li>周志明《深入理解 Java 虚拟机 （第 2 版）》，第 6 章 类文件结构，第 10 章第 3 节 Java语法糖的味道</li>
<li><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html#jvms-4.1">The Java® Virtual Machine Specification, Java SE 8 Edition Chapter 4</a> The class File Format</li>
<li><a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-4.html">The Java® Language Specification, Java SE 8 Edition Chapter 4</a> Types, Values, and Variables</li>
<li><a href="https://github.com/google/guava">Guava</a></li>
<li><a href="https://wiki.openjdk.java.net/display/valhalla">valhalla 项目</a></li>
</ul>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Zeng Xu</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2019-06-28 08:15
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content">本作品采用 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a> 进行许可，转载时请注明原文链接。</span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/java/">java</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/2019-java2go-concurrency/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Java &amp; Go 并发编程对比</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/2019-spring-config-intro/">
            <span class="next-text nav-default">Spring Boot 配置探幽</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:zenngxu@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/phosae" class="iconfont icon-github" title="github"></a>
      <a href="https://weibo.com/u/1566013967" class="iconfont icon-weibo" title="weibo"></a>
  <a href="https://www.zeng.dev/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2019 - 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>Zeng Xu</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-149382924-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
